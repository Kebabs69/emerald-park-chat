<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Civility | Pokec English Edition</title>
    <style>
        /* Classic Pokec Blue & Gray Theme */
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4; color: #333; overflow: hidden; }
        
        /* Top Blue Bar */
        #top-nav { background: #005691; color: white; padding: 5px 15px; display: flex; justify-content: space-between; align-items: center; height: 35px; border-bottom: 2px solid #003d66; }
        .logo { font-weight: bold; font-size: 18px; letter-spacing: 1px; }

        /* Main Container */
        #main-layout { display: grid; grid-template-columns: 180px 1fr 220px; height: calc(100vh - 47px); }

        /* Left Sidebar: Rooms */
        #rooms-sidebar { background: #e2eaf3; border-right: 1px solid #ccc; padding: 10px; }
        .room-category { font-weight: bold; color: #005691; font-size: 13px; margin-bottom: 8px; border-bottom: 1px solid #ccc; }
        .room-link { display: block; padding: 4px 8px; text-decoration: none; color: #444; font-size: 12px; cursor: pointer; border-radius: 3px; }
        .room-link:hover { background: #fff; color: #005691; }
        .room-link.active { background: #005691; color: white; font-weight: bold; }

        /* Middle: Chat Flow */
        #chat-section { display: flex; flex-direction: column; background: #fff; position: relative; }
        #messages { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; border-bottom: 1px solid #ddd; }
        .msg-line { margin-bottom: 5px; border-bottom: 1px dotted #eee; padding-bottom: 2px; }
        .msg-user { font-weight: bold; color: #005691; cursor: pointer; }
        .msg-text { color: #000; margin-left: 5px; }
        .msg-time { color: #999; font-size: 10px; margin-right: 5px; }
        .msg-bot { color: #cc0000; font-style: italic; }

        /* Input Area */
        #input-area { padding: 10px; background: #f9f9f9; display: flex; gap: 5px; }
        #chat-input { flex: 1; padding: 6px; border: 1px solid #aaa; border-radius: 2px; }
        .btn-send { background: #005691; color: white; border: none; padding: 5px 15px; cursor: pointer; font-weight: bold; }

        /* Right Sidebar: Users Online */
        #users-sidebar { background: #f9f9f9; border-left: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        .user-online { font-size: 12px; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
        .status-dot { width: 8px; height: 8px; background: #44b700; border-radius: 50%; }
        .admin-star { color: gold; font-weight: bold; }

        /* Login Overlay */
        #login-overlay { position: fixed; inset: 0; background: #005691; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-box { background: #fff; padding: 25px; border-radius: 5px; box-shadow: 0 0 15px rgba(0,0,0,0.5); width: 280px; text-align: center; }
        .login-box input { width: 90%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color:#005691">Civility English</h2>
            <p style="font-size:12px">Login or Register automatically</p>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Password">
            <button onclick="auth()" class="btn-send" style="width:100%">Enter Chat</button>
        </div>
    </div>

    <div id="top-nav">
        <div class="logo">CIVILITY CHAT</div>
        <div id="user-info" style="font-size: 12px;"></div>
    </div>

    <div id="main-layout">
        <div id="rooms-sidebar">
            <div class="room-category">CHANNELS</div>
            <div class="room-link active" onclick="setRoom('General')">General Lounge</div>
            <div class="room-link" onclick="setRoom('Adults')">Adults 20+</div>
            <div class="room-link" onclick="setRoom('Tech')">Tech & PC</div>
            <div class="room-link" onclick="setRoom('VIP')">ðŸ’Ž VIP Area</div>
            <br>
            <div class="room-category">MY LINKS</div>
            <a href="https://www.buymeacoffee.com/YOURNAME" target="_blank" class="room-link" style="color: #c60">Support Site</a>
        </div>

        <div id="chat-section">
            <div id="messages"></div>
            <div id="input-area">
                <input type="text" id="chat-input" placeholder="Write a message..." onkeypress="if(event.key==='Enter') send()">
                <button class="btn-send" onclick="send()">Send</button>
            </div>
        </div>

        <div id="users-sidebar">
            <div class="room-category">ONLINE</div>
            <div id="user-list"></div>
        </div>
    </div>

    <script>
        let user = JSON.parse(localStorage.getItem('user'));
        let currentRoom = 'General';
        if(user) {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('user-info').innerText = `Logged in as: ${user.username}`;
        }

        async function auth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('pass').value;
            let res = await fetch('/api/login', { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({email, password}) 
            });
            if(!res.ok) {
                res = await fetch('/api/register', { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({username: email.split('@')[0], email, password}) 
                });
            }
            const data = await res.json();
            localStorage.setItem('user', JSON.stringify(data));
            location.reload();
        }

        async function send() {
            const text = document.getElementById('chat-input').value;
            if(!text) return;
            await fetch('/api/messages', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    username: user.username, email: user.email, 
                    text, room: currentRoom, avatar: user.avatar, isAdmin: user.isAdmin
                })
            });
            document.getElementById('chat-input').value = '';
            load();
        }

        async function load() {
            const res = await fetch(`/api/messages?room=${currentRoom}`);
            const data = await res.json();
            const flow = document.getElementById('messages');
            flow.innerHTML = data.map(m => `
                <div class="msg-line">
                    <span class="msg-time">${new Date(m.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                    <span class="msg-user" onclick="alert('Profile of ${m.username}')">${m.username}${m.isAdmin ? '<span class="admin-star">â˜…</span>' : ''}:</span>
                    <span class="msg-text">${m.text}</span>
                </div>
            `).join('');
            flow.scrollTop = flow.scrollHeight;

            // Fake "Who's Online" for that Pokec feel
            document.getElementById('user-list').innerHTML = `
                <div class="user-online"><div class="status-dot"></div> ${user.username} (me)</div>
                <div class="user-online"><div class="status-dot" style="background:#ccc"></div> EmeraldBot ðŸ¤–</div>
            `;
        }

        function setRoom(r) {
            currentRoom = r;
            document.querySelectorAll('.room-link').forEach(l => l.classList.toggle('active', l.innerText.includes(r)));
            load();
        }

        setInterval(load, 3000);
        if(user) load();
    </script>
</body>
</html>