<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokec Secure Chat</title>
    <style>
        :root { --pokec-green: #075e54; --pokec-light: #dcf8c6; --pokec-bg: #e5ddd5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--pokec-bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Auth Screen */
        #auth-overlay { position: fixed; inset: 0; background: var(--pokec-green); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .auth-box { background: white; padding: 30px; border-radius: 15px; width: 320px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        input { width: 100%; margin-bottom: 12px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { background: var(--pokec-green); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer; font-weight: bold; }
        
        /* Chat Interface */
        #chat-container { width: 100%; max-width: 500px; margin: auto; height: 100vh; background: white; display: none; flex-direction: column; }
        header { background: var(--pokec-green); color: white; padding: 15px; text-align: center; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; list-style: none; margin: 0; background: #efeae2; display: flex; flex-direction: column; }
        #messages li { background: white; padding: 10px; border-radius: 10px; margin-bottom: 8px; max-width: 80%; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.1); word-wrap: break-word; }
        #messages li.my-message { align-self: flex-end; background: var(--pokec-light); }
        
        /* Admin Elements */
        #admin-panel { position: fixed; top: 10px; left: 10px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: none; z-index: 2000; width: 250px; }
        .del-btn { color: red; cursor: pointer; font-size: 11px; margin-left: 10px; font-weight: bold; }
        
        form { display: flex; padding: 15px; background: #f0f0f0; gap: 10px; border-top: 1px solid #ddd; }
        #input { flex: 1; border: none; padding: 12px; border-radius: 25px; outline: none; }
    </style>
</head>
<body>
    <div id="auth-overlay">
        <div id="register-ui" class="auth-box">
            <h2 style="color:var(--pokec-green)">Create Account</h2>
            <input type="email" id="re" placeholder="Email Address">
            <input type="text" id="ru" placeholder="Username">
            <input type="password" id="rp" placeholder="Password">
            <button class="btn" onclick="auth('register')">Register</button>
            <p onclick="toggle(true)" style="cursor:pointer; font-size:12px; margin-top:15px; color:#666;">Already a member? Login</p>
            <p id="r-err" style="color:red; font-size:12px;"></p>
        </div>
        <div id="login-ui" class="auth-box" style="display:none;">
            <h2 style="color:var(--pokec-green)">Welcome Back</h2>
            <input type="email" id="le" placeholder="Email Address">
            <input type="password" id="lp" placeholder="Password">
            <button class="btn" onclick="auth('login')">Login</button>
            <p onclick="toggle(false)" style="cursor:pointer; font-size:12px; margin-top:15px; color:#666;">New? Create Account</p>
            <p id="l-err" style="color:red; font-size:12px;"></p>
        </div>
    </div>

    <div id="admin-panel">
        <h4 style="margin:0 0 10px 0;">Admin Tools</h4>
        <button onclick="socket.emit('admin:get-users')" style="font-size:10px; width:100%;">View User List</button>
        <ul id="user-list" style="font-size:11px; padding:10px 0; margin:0; list-style:none;"></ul>
        <button onclick="document.getElementById('admin-panel').style.display='none'" style="width:100%; margin-top:10px;">Close</button>
    </div>

    <div id="chat-container">
        <header>
            <span>Pokec Live</span>
            <span id="admin-link" onclick="document.getElementById('admin-panel').style.display='block'" style="display:none; cursor:pointer; font-size:11px; border:1px solid white; padding:3px 8px; border-radius:4px;">ADMIN</span>
        </header>
        <ul id="messages"></ul>
        <form id="form">
            <input id="input" autocomplete="off" placeholder="Type a message..." />
            <button type="submit" style="background:none; border:none; cursor:pointer; font-size:22px; color:var(--pokec-green)">âž¤</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myUser = "";
        let iAmAdmin = false;

        function toggle(s) {
            document.getElementById('login-ui').style.display = s ? 'block' : 'none';
            document.getElementById('register-ui').style.display = s ? 'none' : 'block';
        }

        function auth(type) {
            const data = type === 'register' ? 
                { email: document.getElementById('re').value, username: document.getElementById('ru').value, password: document.getElementById('rp').value } :
                { email: document.getElementById('le').value, password: document.getElementById('lp').value };
            if(data.email) socket.emit(type, data);
        }

        socket.on('auth success', (data) => {
            myUser = data.username;
            iAmAdmin = data.isAdmin;
            document.getElementById('auth-overlay').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
            if(iAmAdmin) document.getElementById('admin-link').style.display = 'block';
        });

        socket.on('auth error', m => { 
            document.getElementById('r-err').innerText = m; 
            document.getElementById('l-err').innerText = m; 
        });

        function addMsg(data) {
            const li = document.createElement('li');
            if(data.user === myUser) li.classList.add('my-message');
            li.innerHTML = `<strong>${data.user}</strong>: ${data.text}`;
            if(iAmAdmin && data.id) {
                const del = document.createElement('span');
                del.innerText = " (X)";
                del.className = "del-btn";
                del.onclick = () => socket.emit('admin:delete-msg', data.id);
                li.appendChild(del);
            }
            document.getElementById('messages').appendChild(li);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        socket.on('chat message', addMsg);
        socket.on('load history', h => { 
            document.getElementById('messages').innerHTML=''; 
            h.forEach(addMsg); 
        });

        socket.on('admin:user-list', list => {
            document.getElementById('user-list').innerHTML = list.map(u => `<li>${u.username} (${u.email})</li>`).join('<hr>');
        });

        document.getElementById('form').addEventListener('submit', (e) => {
            e.preventDefault();
            const inp = document.getElementById('input');
            if(inp.value.trim()) { socket.emit('chat message', { text: inp.value }); inp.value = ''; }
        });
    </script>
</body>
</html>