<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokec.sk | English Edition</title>
    <style>
        /* CSS RESET & THEME */
        :root { --pokec-blue: #0084ff; --pokec-dark: #1c1e21; --bg: #f0f2f5; --border: #dddfe2; --white: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { background-color: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* TOP AZET NAVIGATION */
        #azet-nav { background: #1a1a1a; color: #bbb; font-size: 11px; padding: 6px 20px; display: flex; gap: 18px; font-weight: 700; align-items: center; }
        #azet-nav span:hover { color: #fff; cursor: pointer; }
        
        /* HEADER */
        header { background: var(--white); border-bottom: 1px solid var(--border); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .logo-area { display: flex; align-items: center; gap: 15px; }
        .logo-area h1 { color: var(--pokec-blue); font-size: 26px; font-weight: 800; letter-spacing: -1px; }
        .search-bar { background: #f0f2f5; border-radius: 20px; padding: 8px 15px; width: 250px; border: 1px solid transparent; font-size: 14px; }

        /* MAIN LAYOUT */
        #main-container { display: grid; grid-template-columns: 240px 1fr 280px; flex: 1; overflow: hidden; }

        /* LEFT SIDEBAR: ROOMS */
        .sidebar-left { background: var(--white); border-right: 1px solid var(--border); overflow-y: auto; padding: 15px 10px; }
        .section-label { color: #65676b; font-size: 13px; font-weight: 600; padding: 10px; text-transform: uppercase; }
        .room-link { display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 8px; cursor: pointer; text-decoration: none; color: #050505; font-size: 15px; font-weight: 500; margin-bottom: 2px; }
        .room-link:hover { background-color: #f2f2f2; }
        .room-link.active { background-color: #e7f3ff; color: var(--pokec-blue); }
        .icon-box { width: 36px; height: 36px; border-radius: 50%; background: #e4e6eb; display: flex; align-items: center; justify-content: center; font-size: 18px; }

        /* MIDDLE: CHAT INTERFACE */
        .chat-view { display: flex; flex-direction: column; background: var(--white); position: relative; }
        .room-header { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .room-info h2 { font-size: 18px; font-weight: 700; }
        
        #message-stream { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        /* POKEC MESSAGE STYLE */
        .msg-block { display: flex; gap: 12px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .user-avatar { width: 48px; height: 48px; border-radius: 10px; background: #ddd; object-fit: cover; border: 1px solid #eee; }
        .msg-content { flex: 1; }
        .msg-top { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .msg-author { font-weight: 700; color: var(--pokec-blue); cursor: pointer; font-size: 14px; }
        .msg-time { color: #90949c; font-size: 11px; }
        .msg-text { font-size: 14px; color: #1c1e21; line-height: 1.45; word-break: break-word; }

        /* INPUT PANEL */
        .input-panel { padding: 20px; border-top: 1px solid var(--border); background: var(--white); }
        .input-wrapper { display: flex; align-items: center; gap: 10px; background: #f0f2f5; border-radius: 25px; padding: 5px 15px; border: 1px solid var(--border); }
        #chat-input { flex: 1; border: none; background: transparent; padding: 10px; outline: none; font-size: 15px; }
        .btn-send { background: var(--pokec-blue); color: white; border: none; padding: 8px 22px; border-radius: 20px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-send:hover { background: #0073e6; transform: scale(1.02); }

        /* RIGHT SIDEBAR: USERS */
        .sidebar-right { background: var(--white); border-left: 1px solid var(--border); overflow-y: auto; padding: 15px; }
        .user-card { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .user-card:hover { background: #f2f2f2; }
        .status-indicator { width: 10px; height: 10px; background: #42b72a; border-radius: 50%; border: 2px solid white; }

        /* AUTH OVERLAY */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 12px 28px rgba(0,0,0,0.1); width: 400px; text-align: center; }
        .auth-card h2 { color: var(--pokec-blue); font-size: 32px; margin-bottom: 10px; }
        .auth-card input { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 16px; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card">
        <h2>Pokec</h2>
        <p style="margin-bottom: 25px; color: #606770;">Sign in to join the Slovak community</p>
        <input type="text" id="reg-user" placeholder="Username (Nick)">
        <input type="email" id="reg-email" placeholder="Email address">
        <input type="password" id="reg-pass" placeholder="Password">
        <button onclick="handleAuth()" class="btn-send" style="width: 100%; padding: 15px; font-size: 16px;">Enter Chat</button>
    </div>
</div>

<div id="azet-nav">
    <span>AZET.SK</span><span>POKEC</span><span>EMAIL</span><span>MAPY</span><span>VIDEO</span><span>SLUÅ½BY</span>
</div>

<header>
    <div class="logo-area">
        <h1>Pokec</h1>
        <input type="text" class="search-bar" placeholder="Search for people...">
    </div>
    <div id="nav-profile" style="font-weight: bold; color: #444;"></div>
</header>

<div id="main-container">
    <aside class="sidebar-left">
        <div class="section-label">Main Rooms</div>
        <div class="room-link active" onclick="changeRoom('General', 'ðŸ˜Š Do pohody')">
            <div class="icon-box">ðŸ˜Š</div> <span>Do pohody</span>
        </div>
        <div class="room-link" onclick="changeRoom('English', 'ðŸ‡¬ðŸ‡§ English Only')">
            <div class="icon-box">ðŸ‡¬ðŸ‡§</div> <span>English Only</span>
        </div>
        <div class="room-link" onclick="changeRoom('Teens', 'ðŸŽ’ Teens')">
            <div class="icon-box">ðŸŽ’</div> <span>Teens 15+</span>
        </div>
        <div class="room-link" onclick="changeRoom('Adults', 'ðŸ”ž Adults')">
            <div class="icon-box">ðŸ”ž</div> <span>Adults Room</span>
        </div>
    </aside>

    <main class="chat-view">
        <div class="room-header">
            <div class="room-info">
                <h2 id="current-room-name">Do pohody</h2>
                <small style="color: #65676b;">Welcome to the general lounge</small>
            </div>
        </div>

        <div id="message-stream"></div>

        <div class="input-panel">
            <div class="input-wrapper">
                <input type="text" id="chat-input" placeholder="Write a message..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="btn-send" onclick="sendMessage()">OdoslaÅ¥</button>
            </div>
        </div>
    </main>

    <aside class="sidebar-right">
        <div class="section-label">Who's Online</div>
        <div id="online-list"></div>
    </aside>
</div>

<script>
    let activeRoom = 'General';
    let currentUser = JSON.parse(localStorage.getItem('user'));

    if(currentUser) {
        document.getElementById('auth-overlay').style.display = 'none';
        document.getElementById('nav-profile').innerText = currentUser.username;
    }

    async function handleAuth() {
        const username = document.getElementById('reg-user').value;
        const email = document.getElementById('reg-email').value;
        const password = document.getElementById('reg-pass').value;

        const res = await fetch('/api/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username, email, password})
        });

        if(res.ok) {
            const data = await res.json();
            localStorage.setItem('user', JSON.stringify(data));
            location.reload();
        } else {
            alert("Error joining. Try a different username.");
        }
    }

    async function sendMessage() {
        const text = document.getElementById('chat-input').value;
        if(!text) return;

        await fetch('/api/messages', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: currentUser.username, 
                email: currentUser.email, 
                text, 
                room: activeRoom
            })
        });
        document.getElementById('chat-input').value = '';
        loadMessages();
    }

    async function loadMessages() {
        const res = await fetch(`/api/messages?room=${activeRoom}`);
        const messages = await res.json();
        const stream = document.getElementById('message-stream');
        
        stream.innerHTML = messages.map(m => `
            <div class="msg-block">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${m.username}" class="user-avatar">
                <div class="msg-content">
                    <div class="msg-top">
                        <span class="msg-author">${m.username}</span>
                        <span class="msg-time">${new Date(m.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                    </div>
                    <div class="msg-text">${m.text}</div>
                </div>
            </div>
        `).join('');
        stream.scrollTop = stream.scrollHeight;
    }

    function changeRoom(id, name) {
        activeRoom = id;
        document.getElementById('current-room-name').innerText = name;
        document.querySelectorAll('.room-link').forEach(l => l.classList.toggle('active', l.innerText.includes(id)));
        loadMessages();
    }

    setInterval(loadMessages, 3000);
    if(currentUser) loadMessages();
</script>
</body>
</html>